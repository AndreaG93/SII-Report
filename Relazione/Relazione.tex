\documentclass[10pt,a4paper, titlepage]{report}

% Pacchetti...
% ----------------------------------------------------------------------------------------- %
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[italian]{babel}
\usepackage{booktabs}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{sidecap}
\usepackage{float}
\usepackage{siunitx}
\usepackage{multirow}
\usepackage{hyperref}
\usepackage{bmpsize}
\usepackage{adjustbox}
\usepackage{footnote}
\usepackage{authblk}

\usepackage{tabularx}
\usepackage[skip=0.5\baselineskip]{caption}


% Usato per personalizzare l'ambiente 'listings'...
% ----------------------------------------------------------------------------------------- %
\lstset{
language=C,
basicstyle=\small\ttfamily,			
keywordstyle=\color{blue},
commentstyle=\color{gray},			
stringstyle=\color{black},			
numbers=left,						
numberstyle=\tiny,					
stepnumber=1,						
breaklines=true						
}

% Usato per aggiugnere la numerazione alle sezioni di tipo 'subsubsection' e inserirle nell'indice...%
\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{4}

% Frontespizio...
% ----------------------------------------------------------------------------------------- %
\title{Progetto del corso di Sicurezza informatica e Internet A.A. 2017-2018}

\author[1]{Andrea Graziani (0273395)}
\author[1]{Alessandro Boccini (0277414)}
\author[1]{Ricardo Gamucci (0274716)}
\affil[1]{Università degli Studi di Roma Tor Vergata}


\date{27 marzo 2019}

% Inzio documento...
% ----------------------------------------------------------------------------------------- %
\begin{document}

\maketitle
\tableofcontents
\newpage

\chapter{Descrizione dell'attacco}

Secondo il rapporto stilato dalla NCCIC\footnote{Cfr. \texttt{https://www.us-cert.gov/ncas/analysis-reports/AR18-275A}}, il malware denominato \textbf{FASTCash} è composto da una serie \textbf{12 file} i quali, attraverso tecniche di \textbf{code injection} tali da alterare il normale comportamento di uno o più processi legittimi, che hanno consentito l'ispezione e alterazione dei dati trasmessi durante transazioni basate su \textbf{protocollo ISO 8583}, hanno permesso agli attaccanti di eseguire operazioni di prelievo fraudolento di denaro dagli ATM.
Tra questi file, di cui riportiamo una lista completa in \ref{tab:MalwareFileList}, spiccano per importanza:

\begin{itemize}
\item Tre file progettati per essere eseguibili su sistemi operativi AIX, uno dei quali responsabile dell'esecuzione della code injection contro i processi operanti sul server bersaglio. Due di essi sono stati analizzati nelle sezioni \ref{sec:2.so} e \ref{sec:InjectionAPIExecutableE}

\item Due versioni di un malware capace di modificare le impostazioni del firewall.

\item Un \textbf{trojan} capace di consentire \textbf{accesso remoto completo} al sistema bersaglio.
\end{itemize}



\begin{table}[h!]
 
    \caption{Lista dei file del malware FASTCash}
    \centering
    \small
    \label{tab:MalwareFileList}
    
    \begin{adjustbox}{center=\textwidth}
 
     \begin{tabular}{l|r}
      \toprule
      \textbf{Nome file} & \textbf{SHA256 digest} \\
      \midrule
      
      Lost\_File.so & \texttt{10ac312c8dd02e417dd24d53c99525c29d74dcbc84730351ad7a4e0a4b1a0eba} \\
      \hline
      Unpacked\_dump\_4a740227eeb82c20... & \texttt{10ac312c8dd02e417dd24d53c99525c29d74dcbc84730351ad7a4e0a4b1a0eba} \\
  \hline
  Lost\_File1\_so\_file & \texttt{3a5ba44f140821849de2d82d5a137c3bb5a736130dddb86b296d94e6b421594c} \\
    \hline
      4f67f3e4a7509af1b2b1c6180a03b3... & \texttt{4a740227eeb82c20286d9c112ef95f0c1380d0e90ffb39fc75c8456db4f60756} \\ 
      \hline
      5cfa1c2cb430bec721063e3e2d144f... & \texttt{820ca1903a30516263d630c7c08f2b95f7b65dffceb21129c51c9e21cf9551c6} \\
      \hline
      Unpacked\_dump\_820ca1903a305162... & \texttt{9ddacbcd0700dc4b9babcd09ac1cebe23a0035099cb612e6c85ff4dffd087a26} \\
      \hline
      8efaabb7b1700686efedadb7949eba... & \texttt{a9bc09a17d55fc790568ac864e3885434a43c33834551e027adb1896a463aafc} \\
      \hline
      d0a8e0b685c2ea775a74389973fc92... & \texttt{ab88f12f0a30b4601dc26dbae57646efb77d5c6382fb25522c529437e5428629} \\
      \hline
      2.so & \texttt{ca9ab48d293cc84092e8db8f0ca99cb155b30c61d32a1da7cd3687de454fe86c} \\
      \hline
      Injection\_API\_executable\_e & \texttt{d465637518024262c063f4a82d799a4e40ff3381014972f24ea18bc23c3b27ee}\\
      \hline
      Injection\_API\_log\_generating\_s & \texttt{e03dc5f1447f243cf1f305c58d95000ef4e7dbcc5c4e91154daa5acd83fea9a8}\\
      \hline
      inject\_api & \texttt{f3e521996c85c0cdb2bfb3a0fd91eb03e25ba6feef2ba3a1da844f1b17278dd2}\\
      
      \bottomrule
    \end{tabular}
    \end{adjustbox}
  
\end{table}

\newpage
\chapter{Analisi dell'attacco di Process Injection}

\section{Introduzione}

In questo capitolo analizzeremo dettagliatamente la tecnica di attacco usata dai cyber-criminali per alterare a loro vantaggio il corretto funzionamento dei server bancari presso le quali erano in esecuzione le applicazioni di \textit{payment switch}.

\subsection{Definizione della forma di attacco}

I rapporti pubblicati dalla NCCIC\footnote{\texttt{https://www.us-cert.gov/ncas/analysis-reports/AR18-275A}} \footnote{\texttt{https://www.us-cert.gov/ncas/alerts/TA18-275A}} e dalla Symantec\footnote{\texttt{https://www.symantec.com/blogs/threat-intelligence/fastcash-lazarus-atm-malware}} indicano che la forma di attacco adottata per compromettere i server dell'istituto bancario fosse stata una \textbf{process injection}.

Con la locuzione \textit{process injection} si intende una tecnica che rende possibile \textit{l'esecuzione di codice arbitrario precedentemente introdotto all'interno dello spazio d'indirizzamento di un processo distinto in esecuzione}.\footnote{\texttt{https://attack.mitre.org/techniques/T1055/}}

L'esecuzione di codice maligno nel contesto di un processo legittimo, oltre a garantire ai cyber-criminali l'accesso a tutte le risorse assegnate al suddetto processo da parte del SO (memoria, risorse di rete, dati ecc.), non viene generalmente individuata dai prodotti commerciali per la sicurezza informatica, essendo l'esecuzione del malware \textit{nascosta}.\footnote{\textit{Ibid.}}

\subsection{Descrizione della variante di attacco adottata}

Esistono molte varianti di attacco di process injection che, sfruttando diverse tipologie di vulnerabilità esposte dal sistema operativo, sono in grado di introdurre con successo codice arbitrario all'interno di un processo; la variante adottata dai cyber-criminali nel malware FASTCash è conosciuta come \textbf{SIR}, acronimo di \textbf{Suspend-Inject-Resume}.

Come facilmente intuibile dal nome, tale tipologia di attacco prevede:\footnote{\texttt{https://www.endgame.com/blog/technical-blog/ten-process-injection-techniques-technical-survey-common-and-trending-process}}
\begin{enumerate}
\item La \textbf{sospensione del processo} bersaglio o, più specificatamente, di tutti i suoi thread. 
\item \textbf{Alterazione dello stato del processo} attraverso la modifica del suo spazio di indirizzamento (\textit{Address Space}) o dei valori contenuti nel suo PCB, come il valore che detiene l'indirizzo della successiva istruzione (\textit{Program Counter}/\textit{Instruction Pointer}) o i dati contenuti nei registri.
\item Il \textbf{riavvio del processo} attaccato in modo tale che esegua il codice maligno precedentemente introdotto.
\end{enumerate}

\subsection{Gli strumenti usati per l'analisi}

Prima di procedere con la descrizione dettagliata dell'attacco perpetrato dal malware FASTCash, riportiamo di seguito i vari tool utilizzati durante le nostre analisi:

\begin{description}
\item[\texttt{strings}]\footnote{Cfr. \texttt{https://linux.die.net/man/1/strings}} Usato per l'estrazione di tutte le stringhe stampabili contenuti in un file.
\item[\texttt{stat}]\footnote{Cfr. \texttt{https://linux.die.net/man/1/stat}} Utilizzato per ottenere alcune informazioni di base dei file tra cui nome, dimensione, data di ultima modifica, ecc.
\item[\texttt{file}]\footnote{Cfr. \texttt{https://linux.die.net/man/1/file}} Usato per determinare la tipologia di appartenenza di uno specifico file.
\item[\texttt{onlinedisassembler}]\footnote{Cfr. \texttt{https://onlinedisassembler.com/}} Il de-assemblaggio dei file è stato eseguito utilizzando il servizio cloud \textbf{onlinedisassembler} che ci ha permesso di ricavare facilmente i listati di codice assembly dei file scritti per le architetture PowerPC\texttrademark.
\end{description}

\newpage
\section{I file di FASTCash responsabili dell'attacco}

In questa sezione analizzeremo i file del malware FASTCash responsabili dell'attacco di process injection contro l'istituto bancario cercando di comprenderne il funzionamento. 

Nel corso di questo capitolo analizzeremo nel dettaglio i seguenti file.

\begin{description}
\item[\texttt{Injection\_API\_executable\_e}] Tale file contiene l'\textit{injection tool}.
\item[\texttt{2.so}] Questo file, insieme a quelli denominati dalla NCCIC come \texttt{Lost\_File1\_\-so\-\_file} e \texttt{Lost\_File.so}, rappresenta una \textit{shared library} contenente i metodi usati per manomettere le transazioni finanziarie ed invocati dal codice maligno introdotto durante la process injection.
\end{description}

Ricordiamo che i sample sono stati ottenuti mediante download dal database di \textit{Hybrid-Analysis}.\footnote{\texttt{https://www.hybrid-analysis.com/}}

\subsection{Il file \texttt{Injection\_API\_executable\_e}}\label{sec:InjectionAPIExecutableE}

L'output ottenuto dal tool \texttt{file} indica che il file \texttt{Injection\_API\_executable\_e}, di cui abbiamo riportato alcuni dettagli nella tabella \ref{tab:FileDetails-1}, è un \textbf{eseguibile} di tipo \textbf{eXtended COFF} (\textbf{XCOFF}), ovvero una versione migliorata ed estesa del formato \textbf{Common Object File Format} (\textbf{COFF}), il formato standard per la definizione dei file a livello strutturale nei sistemi operativi UNIX\footnote{Cfr. \texttt{https://it.wikipedia.org/wiki/COFF}} fino al 1999\footnote{Cfr. \texttt{https://en.wikipedia.org/wiki/Executable\_and\_Linkable\_Format}}, anno della definitiva adozione dello standard \textbf{Executable and Linkable Format} o \textbf{ELF}.

Il formato XCOFF è uno standard proprietario sviluppato da IBM\footnote{Cfr. \texttt{https://www.ibm.com/support/knowledgecenter/ssw\_aix\_72/com.ibm.aix.files/XCOFF.htm}} ed adottato nei sistemi operativi \textbf{Advanced Interactive eXecutive} o \textbf{AIX}, una famiglia di sistemi operativi proprietari basati su Unix sviluppati dalla stessa IBM.\footnote{Cfr. \texttt{https://www.ibm.com/it-infrastructure/power/os/aix}}

\begin{table}[h!]
  
    \caption{Dettagli del file \texttt{Injection\_API\_executable\_e}}
    \centering
    \label{tab:FileDetails-1}
    
    \begin{adjustbox}{center=\textwidth}
 
    \begin{tabular}{l|r}
      \toprule
      \textbf{Descrizione} & \textbf{Valore} \\
      \midrule
      
      Nome & \texttt{\texttt{Injection\_API\_executable\_e}} \\
      \hline
      Dimensione (\textit{byte}) & \texttt{89088} \\
   \hline
      Data ultima modifca & \texttt{2018-11-09 11:08:40.000000000 +0100}\\
   \hline
      Tipo di file & \texttt{64-bit XCOFF executable or object module} \\
    \hline
      MD5 digest & \texttt{b3efec620885e6cf5b60f72e66d908a9}\\ 
 \hline
      SHA1 digest & \texttt{274b0bccb1bfc2731d86782de7babdeece379cf4} \\ 
     \hline
      SHA256 digest & \texttt{d465637518024262c063f4a82d799a4e40ff3381014972f24ea18bc23c3b27ee} \\ 
\hline
      \multirow{2} {*}{SHA512 digest} & \texttt{a36dab1a1bc194b8acc220b23a6e36438d43fc7ac06840daa3d010fddcd9c316}\\
      & \texttt{8a6bf314ee13b58163967ab97a91224bfc6ba482466a9515de537d5d1fa6c5f9}  \\
      
      \bottomrule
    \end{tabular}
    \end{adjustbox}
  
\end{table}

\subsubsection{Analisi delle stringhe}\label{subsection:InjectionAPIExecutableE}

Cominciamo l'analisi studiando alcune delle stringhe più importanti che è possibile estrarre ricorrendo al tool \texttt{strings}.

Osservando innanzitutto il formato della directory di installazione predefinita delle librerie del compilatore \textbf{GCC} nei sistemi operativi AIX, riportato per comodità nel listato \ref{code:InjectionAPIExecutableE-1}\footnote{Cfr: \texttt{http://www.perzl.org/aix/index.php\%3Fn\%3DMain.GCCBinariesVersionNeutral}}, possiamo facilmente conoscere dal frammento mostrato nel listato \ref{code:InjectionAPIExecutableE-1} sia la versione di GCC che quella del sistema operativo AIX utilizzati per eseguire la \textit{build} del malware, le quali risultano essere pari a 4.8.5\footnote{Ulteriori dettagli su: \texttt{https://gcc.gnu.org/gcc-4.8/}} e 7.1\footnote{Ulteriori dettagli su: \texttt{https://www-01.ibm.com/support/docview.wss?uid=isg3T1012517}} rispettivamente. Dallo stesso listato si può apprendere inoltre l'architettura del sistema: la PowerPC\texttrademark.

\begin{lstlisting}[
frame=lines, 
caption={Formato della directory di installazione predefinita delle librerie GCC nei sistemi operativi AIX}, 
label={code:InjectionAPIExecutableE-1},
numbers=none]
/opt/freeware/lib/gcc/<architecture_AIX_level>/<GCC_Level>
\end{lstlisting}

\begin{lstlisting}[
frame=lines, 
caption={Stringhe estratte dal file \texttt{Injection\_API\_executable\_e} (1)}, 
label={code:stringsInjectionAPIexecutablee1},
firstnumber=348]
/opt/freeware/lib/gcc/powerpc-ibm-aix7.1.0.0/4.8.5/ppc64:/opt/freeware/lib/gcc/powerpc-ibm-aix7.1.0.0/4.8.5:/opt/freeware/lib/gcc/powerpc-ibm-aix7.1.0.0/4.8.5/../../..:/usr/lib:/lib
\end{lstlisting}

Sfortunatamente non è stato possibile risalire alla versione degli aggiornamenti, identificati dalla stessa IBM con il nome di \textit{Technology Levels} (TLs) \footnote{Cfr: \texttt{http://ibmsystemsmag.com/aix/tipstechniques/migration/oslevel\_versions/}}, installati sul sistema operativo bersaglio al momento dell'attacco, pertanto non possiamo escludere lo sfruttamento di una qualche vulnerabilità nota da parte degli attaccanti; in ogni caso, dal momento che il malware è stato compilato per la versione 7.1 di AIX, possiamo presupporre che la versione del sistema operativo attaccato fosse almeno pari alla 7.1. E' importante ricordare che   il supporto ufficiale da parte di IBM nei confronti della versione 7.1 di AIX TL0, sostituita dalla ben più moderna versione 7.2 rilasciata nel dicembre 2015, è stata già terminata nel novembre 2013, benché la versione 7.1 TL5 riceverà ancora aggiornamenti da parte di IBM fino ad aprile 2022.\footnote{Cfr: \texttt{https://www-01.ibm.com/support/docview.wss?uid=isg3T1012517}}

\begin{lstlisting}[
frame=lines, 
caption={Stringhe estratte dal file \texttt{Injection\_API\_executable\_e} (2)}, 
label={code:stringsInjectionAPIexecutablee2},
firstnumber=945]
IBM XL C for AIX, Version 11.1.0.1
\end{lstlisting}

Il particolare mostrato nel listato \ref{code:stringsInjectionAPIexecutablee2} dimostra l'uso da parte degli attaccanti del software \textbf{XL C/C++ for AIX} versione 11.1.0.1, un compilatore C/C++ appositamente ottimizzato dalla IBM per i propri sistemi operativi\footnote{Cfr. \texttt{https://www.ibm.com/it-it/marketplace/xl-cpp-aix-compiler-power}}, confermando, insieme ai numerosi riferimenti alle ben note librerie standard di C, come il C/C++ sia stato il linguaggio di programmazione scelto per implementare il malware.

Osservando il frammento mostrato nel listato \ref{code:stringsInjectionAPIexecutablee3}, è possibile notare un insieme di stringhe, aventi formato \texttt{([FUNCTION\_NAME] \textit{info})}, le quali, come avremo modo di notare durante l'analisi del codice assembly, fanno parte certamente di un meccanismo di logging sfruttato dagli attaccanti; tale aspetto è stato confermato dalla già citata analisi della NCCIC

Con ogni probabilità, le suddette stampe sono state realizzate per mezzo della funzione della libreria standard \texttt{snprintf}, come dimostrato dal codice assembly e dai numerosi riferimenti alla suddetta funzione presenti nel file. E' interessante notare come molte delle stampe coinvolgano numeri interi senza segno in forma esadecimale, come dimostrato dall'uso dei \textit{conversion specifier} (le speciali sequenze di caratteri usati abitualmente nella definizione del formato di output nelle funzioni \texttt{printf}) nella forma \texttt{\%llX}\footnote{Cfr. \texttt{http://man7.org/linux/man-pages/man3/printf.3.html}}.

Queste stampe di log coinvolgono gran parte delle funzioni implementate nel file e presumibilmente sono state utilizzate dagli attaccanti per motivi di debug e racconta di informazioni arricchite anche da indicazioni temporali, come dimostrano l'uso delle funzioni \texttt{gettimeofday} e \texttt{localtime}. Inoltre, la presenza di procedura denominata \texttt{out\_log}, analizzata in dettaglio in \ref{sec:2.so}, dimostra che le suddette stampe siano state scritte in memoria di massa.

Infine le righe le righe 333, 334 e 335 del listato \ref{code:stringsInjectionAPIexecutablee3} indicano che il malware sia stato implementato sotto forma di una \textbf{command-line utility interattiva}; tale supposizione è stata confermata anche dall'analisi NCCIC.

\begin{lstlisting}[
frame=lines, 
caption={Stringhe estratte dal file \texttt{Injection\_API\_executable\_e} (3)}, 
label={code:stringsInjectionAPIexecutablee3},
firstnumber=320]
...
[main] Inject Start
[main] SAVE REGISTRY
[main] proc_readmemory fail
[main] toc=%llX
[main] path::%s
[main] data(%p)::%s
[main] Exec func(%llX) OK
[main] Exec func(%llX) fail ret=%X
[main] Inject OK(%llX)
[main] Inject fail ret=%llX
[main] Eject OK
[main] Eject fail ret=%llX
Usage: injection pid dll_path mode [handle func toc]
       mode = 0 => Injection
       mode = 1 => Ejection
[main] handle=%llX, func=%llX, toc=%llX
[main] ERROR::g_pid(%X) <= 0
[main] ERROR::load_config fail
[main] ERROR::eject & argc != 7
[main] ERROR::g_dl_handle(%llX) <= 0
[main] WARNING::func_addr(%llX), toc_addr(%llX)
...
\end{lstlisting}

Prima di analizzare nel dettaglio l'attacco di code injection vero e proprio, è indispensabile dapprima comprendere come vengono rappresentati e gestiti i \textbf{processi} nei sistemi operativi AIX.
Ogni particolare aspetto di un processo, come, ad esempio, il suo stato, i sui livelli di privilegio o il proprio spazio di indirizzamento, è descritto da un insieme di file. Quest'ultimi, dato un processo il cui identificatore sia pari a \texttt{pid}, sono tutti raccolti nella directory \texttt{/proc/pid}. Tale sistema di gestione dei processi adottato da AIX permette di:

\begin{itemize}
\item Conoscere i \texttt{pid} di \textbf{tutti} i processi del sistema attraverso il listing nella directory \texttt{/proc}.
\item Accedere alle informazioni di un dato processo attraverso semplici operazioni di lettura e scrittura sui suddetti file, utilizzando ad esempio le \textit{system call} standard come \texttt{open()}, \texttt{close()}, \texttt{read()} e \texttt{write()}. \footnote{Cfr. IBM - \textit{AIX Version 7.1: Files References} - pag. 232-246}
\end{itemize}

Di questi file, alcuni dei quali sono riportati a titolo di esempio nella tabella \ref{tab:AIXProcessFiles}\footnote{La lista completa è disponibile in \textit{ivi} pag. 246}, ricordiamo in particolare:

\begin{description}
\item[/proc/pid/as] Contiene l'immagine dello spazio degli indirizzi del processo e può essere aperto sia per la lettura che per la scrittura e supporta la subroutine \texttt{lseek} per accedere all'indirizzo virtuale di interesse.\footnote{\textit{Cfr. ivi} pag. 232}

\item[/proc/pid/ctl] Un file di sola scrittura attraverso cui è possibile modificare lo stato del processo e alterare dunque il suo comportamento. La scrittura avviene per mezzo di opportuni \textbf{messaggi} scritti direttamente sul file con effetti immediati.\footnote{\textit{Cfr. ivi} pag. 232}

\item[/proc/pid/status] Contiene informazioni sullo stato del processo. \footnote{\textit{Cfr. ivi} pag. 232}
\end{description}

\begin{table}[h!]
 
    \caption{Sottoinsieme dei file contenuti in \texttt{/proc/pid} }
    \centering
    \label{tab:AIXProcessFiles}
    
    \begin{tabular}{l|r}
      \toprule
      File & Descrizione \\
      \midrule
      \texttt{/proc/pid/status} & \textit{Status of process \texttt{pid}} \\
      \hline
      \texttt{/proc/pid/ctl} & \textit{Control file for process \texttt{pid}} \\
       \hline
      \texttt{/proc/pid/as} & \textit{Address space of process \texttt{pid}} \\
       \hline
      \texttt{/proc/pid/cred} & \textit{Credentials information for process \texttt{pid}} \\
       \hline
      \texttt{/proc/pid/sigact} &\textit{Signal actions for process \texttt{pid}} \\
       \hline
      \texttt{/proc/pid/sysent} & \textit{System call information for process \texttt{pid}}\\
       
      \bottomrule
    \end{tabular}
\end{table}

Come mostrato nel listato \ref{code:stringsInjectionAPIexecutablee4}, sono state individuate all'interno del file tre stringhe che fanno riferimento ai suddetti file descrittori di processo ed, in particolare, ai file \texttt{ctl}, \texttt{status} e \texttt{as}.

Come dimostrato dall'analisi della NCCIC, dalla nostra analisi del codice assembler e anche dalla presenza del \textit{conversion specifier} \texttt{\%d}, non c'è dubbio che il malware, dopo aver individuato l'identificatore del processo bersaglio, ricostruisca, per mezzo della funzione \texttt{sprintf}, i percorsi completi verso i suddetti file per poi ispezionare e manipolarne il contenuto.

\begin{lstlisting}[
frame=lines, 
caption={Stringhe estratte dal file \texttt{Injection\_API\_executable\_e} (4)}, 
label={code:stringsInjectionAPIexecutablee4},
firstnumber=320]
/proc/%d/ctl
/proc/%d/status
/proc/%d/as
\end{lstlisting}

Analizziamo ora nel dettaglio cosa può essere effettivamente scritto all'interno dei suddetti file.

La documentazione ufficiale rilasciata dalla IBM riporta l'esistenza di un insieme di \textbf{messaggi strutturati}\footnote{La documentazione IBM usa in modo intercambiabile il termine \textit{messaggio} e quello di \textit{segnale}}, ognuno dei quali identificato da un codice operativo, rappresentato da un valore \texttt{int}, e da una serie di argomenti (se presenti)\footnote{\textit{Cfr. ivi} pag. 242}. Come già detto, questi messaggi possono essere scritti direttamente nel file \texttt{ctl} di un dato processo, alterandone lo stato.

Osservando il listato \ref{code:stringsInjectionAPIexecutablee5}, notiamo una stampa del logger all'interno è presente la stringa \textbf{PCWSTOP}; \textbf{PCWSTOP} è il nome di un messaggio definito nei sistemi operativi AIX che viene usato per sospendere l'esecuzione di un processo il cui \texttt{pid} viene passato come argomento.\footnote{Cfr. \textit{Ibidem}}
I risultati della NCCIC e le nostre analisi sul codice assembly indicano che il malware usi questo ed altri messaggi per interrompere dapprima il processo bersaglio, accedere al suo spazio di indirizzamento, effettuare la code injection per poi riavviare il processo affinché esegua effettivamente il codice malevolo.

\begin{lstlisting}[
frame=lines, 
caption={Stringhe estratte dal file \texttt{Injection\_API\_executable\_e} (5)}, 
label={code:stringsInjectionAPIexecutablee5},
firstnumber=319]
...
[proc_wait] PCWSTOP pid=%d, ret=%d, err=%d(%s)
[proc_wait] tid=%d, why=%d, what=%d, flag=%d, sig=%d
...
\end{lstlisting}

Gli altri tipi di messaggi usati dagli attaccanti sono visibili nel listato \ref{code:stringsInjectionAPIexecutablee6} tra cui spiccano per importanza:

\begin{description}
\item[PCSET] Serve per passare una serie di flag ad un processo (PR\_ASYNC, PR\_FORK, PR\_KLC ecc.) per modificarne lo stato.\footnote{\textit{Cfr. ivi} pag. 234} 
\item[PCRUN] Riesegue un thread dopo essere stato arrestato.
\item[PCSENTRY] Il thread corrente viene interrotto nel momento in cui richiama una specifica system call. 
\item[PCSFAULT] Definisce un insieme di \textit{hardware faults} "tracciabili" nel processo. Il thread si interrompe quando si verifica una fault.\footnote{\textit{Cfr. ibidem}} 
\end{description}

\begin{lstlisting}[
frame=lines, 
caption={Stringhe estratte dal file \texttt{Injection\_API\_executable\_e} (6)}, 
label={code:stringsInjectionAPIexecutablee6},
firstnumber=299]
...
[proc_attach] PCSET pid=%d, ret=%d, err=%d(%s)
[proc_attach] PCSTOP pid=%d, ret=%d, err=%d(%s)
[proc_attach] PCSTRACE pid=%d, ret=%d, err=%d(%s)
[proc_attach] PCSFAULT pid=%d, ret=%d, err=%d(%s)
[proc_attach] PCSENTRY pid=%d, ret=%d, err=%d(%s)
[proc_detach] PCSTRACE pid=%d, ret=%d, err=%d(%s)
[proc_detach] PCSFAULT pid=%d, ret=%d, err=%d(%s)
[proc_detach] PCSENTRY pid=%d, ret=%d, err=%d(%s)
[proc_detach] PCRUN pid=%d, ret=%d, err=%d(%s)
...
\end{lstlisting}

Come dimostrano i log mostrati nei listati \ref{code:stringsInjectionAPIexecutablee7} e \ref{code:stringsInjectionAPIexecutablee8}, il malware non si limita solo alla scrittura dei messaggi nei file di controllo dei processi ma raccoglie ed altera le informazioni presenti nei registri del processore, parte dei quali sono riportati nella tabella \ref{tab:PowerPCRegister}\footnote{Cfr. \textit{AIX Version 7.1: Assembler Language Reference} per una lista completa oppure visita \texttt{https://www.ibm.com/support/knowledgecenter/en/ssw\_aix\_71/com.ibm.aix.alangref/idalangref\_arch\_overview.htm} o \texttt{https://www.ibm.com/support/knowledgecenter/en/ssw\_aix\_71/com.ibm.aix.kdb/kdb\_registers.htm}}

\begin{lstlisting}[
frame=lines, 
caption={Stringhe estratte dal file \texttt{Injection\_API\_executable\_e} (7)}, 
label={code:stringsInjectionAPIexecutablee7},
firstnumber=299]
...
[proc_getregs] GETREG pid=%d, ret=%d, err=%d(%s)
[proc_getregs] GETSTATUS pr_syscall=%d, pr_why=%d, pr_what=%d, pr_flags=%d, pr_cursig=%d
[proc_setregs] SETREG pid=%d, ret=%d, err=%d(%s)
...
\end{lstlisting}

\begin{lstlisting}[
frame=lines, 
caption={Stringhe estratte dal file \texttt{Injection\_API\_executable\_e} (8)}, 
label={code:stringsInjectionAPIexecutablee8},
firstnumber=320]
[out_regs] IAR=%llX
[out_regs] MSR=%llX
[out_regs] CR=%llX
[out_regs] LR=%llX
[out_regs] CTR=%llX
[out_regs] GPR%d=%llX
\end{lstlisting}

\begin{table}[h!]
    \caption{Breve descrizione dei registri ispezionati dal malware}
    \centering
    \begin{adjustbox}{center=\textwidth}
    \label{tab:PowerPCRegister}
    
    \begin{tabular}{l|l|p{8cm}}
      \toprule
      Registro & Nome esteso & Descrizione \\
      \midrule
      \texttt{LR} & Link Register & E' usato per ospitare l'indirizzo dell'istruzione successiva ad una operazione di salto. E' usata principalmente per ospitare l'indirizzo di ritorno al termine di una funzione. \\
      
      \texttt{CR} & Condition Register & Un registro da 32 bit usato per specificare varie classi di operazioni.\\
      
      \texttt{CTR} & Control Register & Un registro da 32 bit usato per specificare varie classi di operazioni.\\
      
      \texttt{IAR} & Instruction Address Register & Usato per contenere l'indirizzo dell'istruzione successiva.\\
      
      \texttt{MSR} & Machine State Register & Registro da 32 bit usato per specificare varie classi di operazioni.\\
     
	\texttt{r0-r31} & General Purpose Registers (GPRs) from 0 through 31 & Registri per usi generici. \\   
     
      \bottomrule
    \end{tabular}
    \end{adjustbox}
\end{table}

Mostriamo infine nel listato \ref{code:stringsInjectionAPIexecutablee9} un log che dimostra come il malware dapprima accede ispezionando l'area di memoria riservata di un processo per poi alterarla eseguendo un'operazione di scrittura, completando in tal modo l'attacco di code injection che si conclude definitamente con il riavvio del processo attaccato.

\begin{lstlisting}[
frame=lines, 
caption={Stringhe estratte dal file \texttt{Injection\_API\_executable\_e} (9)}, 
label={code:stringsInjectionAPIexecutablee9},
firstnumber=308]
...
[proc_readmemory] ret=%d, err=%d(%s), addr=%p, len=%d, data=%p
[proc_readmemory] (%X~%X) %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X
[proc_writememory] ret=%d, err=%d(%s), addr=%p, len=%d, data=%p
...
\end{lstlisting}


	\newpage
\subsubsection{Analisi del codice assembly}
	
	\begin{table}[h!]
	    \caption{Alcune istruzioni assembly disponibili nell'architettura PowerPC\texttrademark}
	    \centering
	    
	    \label{tab:AssemblyIstrucions}
	    \begin{adjustbox}{center=\textwidth}
	    \begin{tabular}{l|l|l|p{6cm}}
	      \toprule
	      Istruzione & Nome & Argomenti & Descrizione \\
	   		\midrule
	   		\texttt{bl} & \textit{Branch Link} & \texttt{\textit{target\_address}} & \textit{Branches to a specified target address.} \\
	   	\hline
   	       \texttt{mfcr} & \textit{Move From Condition Register} & \texttt{RT} & \textit{Copies the contents of the Condition Register into a general-purpose register.} \\
 \hline
	       \texttt{std} & \textit{STore Doubleword} & \texttt{RS,\textit{Offset},RSML} & \textit{Store a doubleword of data from a general purpose register into a specified memory location.}\\
	      \hline 
	       \texttt{stw} & \textit{STore Word} & \texttt{RS,\textit{Offset},RSML} & \textit{Stores a word of data from a general-purpose register into a specified location in memory.} \\
	       \hline
	       \texttt{li} & \textit{Load Immediate} & \texttt{RT,\textit{Value}} & \textit{Copies specified value into a general-purpose register.} \\
	       \hline
	       \texttt{ld} & \textit{Load Doubleword} & \texttt{RT,\textit{Offset},RS} & \textit{Load a doubleword of data into the specified general purpose register.} \\
	       \hline
	       \texttt{mr} & \textit{Move Register} & \texttt{RT,RS} & \textit{Copies the contents of one register into another register.} \\
	       \hline
	       \texttt{addi} & \textit{ADD Immediate} & \texttt{RT,RS,\textit{Value}} & \textit{Place the sum of the contents of RA and the 16-bit two's complement integer value, sign-extended to 32 bits, into the target RT.} \\
	       	\hline
	       	\texttt{mtrl} & \textit{Move To Link Register} & \texttt{RS} & \textit{Copies the contents of RS register into Link Register.} \\
\hline
\texttt{extsw} & \textit{Extend Sign Word} & \texttt{RT,RS} & \textit{Copy the low-order 32 bits of a general purpose register into another general purpose register, and signextend the fullword to a doubleword in size (64 bits).} \\
	       	
	     
	      \bottomrule
	    \end{tabular}
	       \end{adjustbox}
	\end{table}

\subsubsection{La procedura \texttt{main}} 

La parte iniziale della procedura \texttt{main} è caratterizzata da una serie di operazioni che coinvolgono stringhe come dimostrano la serie di istruzioni di salto condizionato verso le funzioni \texttt{strlen} (riga 7028), \texttt{strncpy} (riga 7035) e \texttt{strtoull} (riga 6973, 6984 e 6995) che probabilmente sono state utilizzate per raccogliere informazioni. Sono presenti due istruzioni di salto vero le funzioni \texttt{atoi} (riga 7015 e 7041) usate per convertire i parametri passati dagli attaccanti attraverso la linea di comando il che dimostra la natura interattiva del malware.

Dopo una serie di istruzioni di salto verso procedure varie procedure di inizilizzazione, tra cui spiccano \texttt{load\_config} e \texttt{get\_func\_addr}, viene raggiunta la porzione di codice mostrata nel listato \ref{code:AssemblyFunction-main-1} dove, dopo aver copiato i dati necessari in alcuni registri attraverso le apposite istruzioni mr, vengono eseguite a cascata due istruzioni di salto verso una procedura chiamata inject, che contiene il codice operativo per l'esecuzione della code injection. 

\begin{lstlisting}[
frame=lines, 
caption={Codice assembly estratto dal file \texttt{Injection\_API\_executable\_e}}, 
label={code:AssemblyFunction-main-1},
firstnumber=308]
mr      r3,r10
mr      r4,r9
addi    r5,r2,-728
bl      0x1000256c <.inject>
li      r3,120
bl      0x10003468 <.sleep>
ld      r2,40(r1)
addi    r10,r31,120
lwz     r9,116(r31)
extsw   r9,r9
mr      r3,r10
mr      r4,r9
li      r5,0
bl      0x1000256c <.inject>
bl      0x10001154 <.CloseHandle>
\end{lstlisting}



\subsubsection{La procedura \texttt{inject}}

In questo paragrafo descriveremo le operazioni eseguite dalla procedura chiamata \texttt{inject} a cui gli autori del malware hanno affidato il compito di eseguire l'attacco di code injection a danno del processo bersaglio.
Nel listato \ref{code:AssemblyFunction-inject-01} viene mostrato il frammento corrispondente alla prima parte della suddetta funzione, all'interno del quale possiamo distinguere le seguenti operazioni:
\begin{itemize}
\item Copia nel \textit{link register} dell'indirizzo di ritorno dal registro \texttt{r0} attraverso l'istruzione \texttt{mflr}.
\item Inizializzazione di vari registri necessari attraverso varie istruzioni \texttt{std} e \texttt{mr} che coinvolgono i registri \texttt{r4}, \texttt{r5},\texttt{r9} e  \texttt{r31}, quest'ultimo probabilmente adibito ad ospitare l'indirizzo di memoria di base da cui viene computato l'indirizzo da cui prelevare i dati dalla memoria. Si presupponi che i registri precedentemente menzionati ospiteranno gli indirizzi alle celle di memoria contenenti il codice malevolo che verrà poi scritto all'interno dello spazio di indirizzamento del processo bersaglio.
\item Esecuzione della code injection vera e propria attraverso una serie di istruzioni di salto (\texttt{bl}) verso l'indirizzo \texttt{0x10002f00} corrispondente alla prima istruzione della funzione \texttt{memset} preceduta dalle necessarie inizializzazioni dei registri di input attraverso varie istruzioni \texttt{mr}.
\end{itemize}

\begin{lstlisting}[
frame=lines, 
caption={Codice assembly estratto dal file \texttt{Injection\_API\_executable\_e}}, 
label={code:AssemblyFunction-inject-01},
firstnumber=308]
mflr    r0
std     r0,16(r1)
std     r31,-8(r1)
stdu    r1,-1520(r1)
mr      r31,r1
std     r3,1568(r31)
mr      r9,r4
std     r5,1584(r31)
stw     r9,1576(r31)
li      r9,0
stw     r9,120(r31)
li      r9,0
std     r9,144(r31)
addi    r10,r31,152
li      r9,384
mr      r3,r10
li      r4,0
mr      r5,r9
bl      0x10002f00 <.memset>
nop
addi    r10,r31,536
li      r9,384
mr      r3,r10
li      r4,0
mr      r5,r9
bl      0x10002f00 <.memset>
nop
addi    r10,r31,920
li      r9,256
mr      r3,r10
li      r4,0
mr      r5,r9
bl      0x10002f00 <.memset>
\end{lstlisting}

Dopo una serie di istruzioni di salto verso la funzione \texttt{memset}, ed aver dunque conclusa le operazioni di modifica della memoria del processo attaccato, possiamo osservare le successive operazioni eseguite dal listato \ref{code:AssemblyFunction-inject-02} in cui apprendiamo che:

\begin{itemize}
\item Vengono eseguite ben tre istruzioni \texttt{bl} per permettere l'esecuzione della procedura \texttt{out\_log} per effettuare la scrittura delle informazioni di interesse su un file esterno.
\item Vengono diverse istruzioni di salto per eseguire varie procedure tra cui quella denominata \texttt{proc\_attach}, usata probabilmente per modificare alcune informazioni di stato del processo, la \texttt{proc\_wait}, usata probabilmente per arrestare l'esecuzione del processo bersaglio, \texttt{proc\_getregs} ed \texttt{out\_regs} usate rispettivamente per leggere i valori contenuti nei registri e successivamente scriverli in un file di log.

\end{itemize}

\begin{lstlisting}[
frame=lines, 
caption={Codice assembly estratto dal file \texttt{Injection\_API\_executable\_e}}, 
label={code:AssemblyFunction-inject-02},
firstnumber=308]
bl      0x10000674 <.out_log>
bl      0x10001220 <.proc_attach>
li      r3,0
bl      0x10001a28 <.proc_continue>
li      r3,0
li      r4,0
bl      0x10001b44 <.proc_wait>
ld      r3,728(r2)
bl      0x10000674 <.out_log>
addi    r9,r31,152
mr      r3,r9
bl      0x10001ee4 <.proc_getregs>
addi    r9,r31,152
mr      r3,r9
bl      0x10000c80 <.out_regs>
\end{lstlisting}

Dopo una serie di istruzioni di salto verso altre funzioni, tra cui figura una denominata \texttt{proc\_readmemory}, avviene l'ultima fase della code injection durante la quale, come dimostrato dal listato \ref{code:AssemblyFunction-inject-03}, viene alterata la memoria del processo bersaglio attraverso istruzioni di salto verso le procedure \texttt{proc\_writememory}, usata probabilmente per indurre il processo bersaglio a eseguire il codice malevolo copiato in precedenza, e la \texttt{proc\_setregs} usata per alterare il contenuto dei registri e dunque modificare il futuro comportamento del processo. La procedura si conclude con il riavvio del processo e una lunga fase di log attraverso una grande quantità di istruzioni di salto verso la procedura \texttt{out\_log}.

\begin{lstlisting}[
frame=lines, 
caption={Codice assembly estratto dal file \texttt{Injection\_API\_executable\_e}}, 
label={code:AssemblyFunction-inject-03},
firstnumber=308]
bl      0x10002460 <.proc_writememory>
addi    r9,r31,536
mr      r3,r9
bl      0x10000c80 <.out_regs>
addi    r9,r31,536
mr      r3,r9
bl      0x10002068 <.proc_setregs>
li      r3,3
bl      0x10001a28 <.proc_continue>
li      r3,6
li      r4,11
bl      0x10001b44 <.proc_wait>
addi    r9,r31,536
mr      r3,r9
bl      0x10001ee4 <.proc_getregs>
addi    r9,r31,536
mr      r3,r9
bl      0x10000c80 <.out_regs>
\end{lstlisting}

\subsubsection{La procedura \texttt{proc\_attach}}

Analizziamo nel dettaglio l'attacco al processo la quale si compone in varie fare.
Nel listato possiamo osservare come vengono dapprima eseguite delle operazioni di store ward con diversi offset con un registro comune come indirizzo sorgente; 

Successivamente gli attaccanti utilizzano quello che probabilmente si tratti dell'indirizzo dell'area di memoria del processo bersaglio e con ripetute operazioni si store word muove il puntatore a quell'area di memoria con step da 4 byte. Alla fine, raggiunta la posizione desiderata, sposta il risultato in vari registri e esegue un'operazione di salto (bl) che punta all'indirizzo per la funzione memset.

\begin{lstlisting}
[
frame=lines, 
caption={Codice assembly estratto dal file \texttt{Injection\_API\_executable\_e}}, 
label={code:AssemblyFunction-inject-04},
firstnumber=308]
<.proc_attach>:
mflr    r0
std     r0,16(r1)
std     r29,-24(r1)
std     r30,-16(r1)
std     r31,-8(r1)
stdu    r1,-352(r1)
mr      r31,r1
li      r9,0
stw     r9,128(r31)
li      r9,0
stw     r9,132(r31)
li      r9,0
std     r9,136(r31)
li      r9,0
std     r9,144(r31)
li      r9,0
std     r9,152(r31)
li      r9,0
std     r9,160(r31)
li      r9,0
std     r9,168(r31)
li      r9,0
stw     r9,176(r31)
addi    r10,r31,180
li      r9,140
mr      r3,r10
li      r4,0
mr      r5,r9
bl      0x10002f00 <.memset>
\end{lstlisting}

Dopo aver richiamato la funzione \texttt{memset}, certamente utilizzata dagli attaccanti per eseguire la \textit{code injection} alterando il contenuto dello spazio di indirizzamento del processo bersaglio, la funzione \texttt{proc\_attach} incomincia una fase di logging durante la quale, attraverso ripetuti salti condizionati agli indirizzi \texttt{0x100031ec}, \texttt{0x1000319c} e \texttt{0x10000674}, corrispondenti agli indirizzi delle funzioni \texttt{write}, \texttt{sterror} (utilizzata certamente dagli attaccanti per verificare l'output della funzione \texttt{write}), \texttt{log\_out}, vengono archiviati in un file esterno il contenuto dei registri di interesse che paiono essere i registri r31, r30, r29 e r9 che vengono copiati con ripetute istruzioni \texttt{mr} in registri ausiliari (r4, r5, r6 e r7 rispettivamente) prima di essere inviati come input alla funzione \texttt{log\_out}.

\begin{lstlisting}
[
frame=lines, 
caption={Codice assembly estratto dal file \texttt{Injection\_API\_executable\_e}}, 
label={code:AssemblyFunction-inject-05},
firstnumber=308]
li      r9,14
stw     r9,136(r31)
li      r9,4
stw     r9,140(r31)
addi    r9,r2,-764
lwz     r9,0(r9)
extsw   r10,r9
addi    r9,r31,136
mr      r3,r10
mr      r4,r9
li      r5,8
bl      0x100031ec <.write>
ld      r2,40(r1)
mr      r9,r3
stw     r9,128(r31)
addi    r9,r2,-768
lwz     r9,0(r9)
extsw   r29,r9
ld      r9,128(r2)
lwz     r9,0(r9)
extsw   r30,r9
ld      r9,128(r2)
lwz     r9,0(r9)
extsw   r9,r9
mr      r3,r9
bl      0x1000319c <.strerror>
ld      r2,40(r1)
mr      r9,r3
lwz     r10,128(r31)
extsw   r10,r10
ld      r3,536(r2)
mr      r4,r29
mr      r5,r10
mr      r6,r30
mr      r7,r9
bl      0x10000674 <.out_log>
\end{lstlisting}

La fase di code injection si conclude con il caricamento nel registro \texttt{r0} dell'indirizzo della funzione chiamante copiato successivamente nel link register attraverso l'istruzione \texttt{mtrl}; vengono in seguito eseguite una serie di istruzioni ld per popolare i registri r29, r30 e r31 che conterranno probabilmente i valori di ritorno della funzione per poi eseguire una istruzione \texttt{blr} (\textit{Branch Link Register}).

\begin{lstlisting}
ld      r0,16(r1)
mtlr    r0
ld      r29,-24(r1)
ld      r30,-16(r1)
ld      r31,-8(r1)
blr
\end{lstlisting}


\begin{lstlisting}
bl      0x10000674 <.out_log>
bl      0x10001220 <.proc_attach>
li      r3,0
bl      0x10001a28 <.proc_continue>
li      r3,0
li      r4,0
bl      0x10001b44 <.proc_wait>
ld      r3,728(r2)
bl      0x10000674 <.out_log>
addi    r9,r31,152
mr      r3,r9
bl      0x10001ee4 <.proc_getregs>
addi    r9,r31,152
mr      r3,r9
bl      0x10000c80 <.out_regs>
addi    r8,r31,536
addi    r10,r31,152
li      r9,384
mr      r3,r8
mr      r4,r10
mr      r5,r9
bl      0x1000324c <.memmove>
nop
ld      r9,536(r31)
addi    r9,r9,-16
mr      r3,r9
li      r4,16384
bl      0x10000b48 <.file_dump>
\end{lstlisting}















\newpage
\subsection{Il file \texttt{2.so}}\label{sec:2.so}

\texttt{2.so} è un file di tipo \textbf{eXtended COFF} che, come dimostreremo all'interno di questa sezione, è stato progettato per l'ispezione e la manipolazione dei dati contenuti nei messaggi basati sul protocollo \textbf{ISO8583} scambiati tra i sistemi informatici degli istituti finanziari. Come dimostrato anche dalla già citata analisi AR18-275A della NCCIC, il file, come suggerisce anche l'estensione \texttt{.so}, rappresenta una \textbf{shared library} che, esportando una grande quantità di metodi in grado di interagire con i messaggi basati sul suddetto protocollo, permette agli attaccanti di alterare le transazioni finanziare a proprio favore.

\begin{table}[h!]
  
    \caption{Dettagli del file \texttt{2.s0}}
    \centering
    \label{tab:table1}
    
    \begin{adjustbox}{center=\textwidth}
 
    \begin{tabular}{l|r}
      \toprule
      \textbf{Descrizione} & \textbf{Valore} \\
      \midrule
      
      Nome & \texttt{2.so} \\
      \hline
      Dimensione (\textit{byte}) & \texttt{110592} \\
   \hline
      Data ultima modifca & \texttt{2018-11-09 11:08:40.000000000 +0100}\\
   \hline
      Tipo di file & \texttt{64-bit XCOFF executable or object module} \\
    \hline
      MD5 digest & \texttt{b66be2f7c046205b01453951c161e6cc}\\ 
 \hline
      SHA1 digest & \texttt{ec5784548ffb33055d224c184ab2393f47566c7a} \\ 
     \hline
      SHA256 digest & \texttt{ca9ab48d293cc84092e8db8f0ca99cb155b30c61d32a1da7cd3687de454fe86c} \\ 
\hline
      \multirow{2} {*}{SHA512 digest} & \texttt{6890dcce36a87b4bb2d71e177f10ba27f517d1a53ab02500296f9b3aac021810}\\
      & \texttt{7ced483d70d757a54a5f7489106efa1c1830ef12c93a7f6f240f112c3e90efb5}  \\
      
      \bottomrule
    \end{tabular}
    \end{adjustbox}
  
\end{table}

\subsubsection{Analisi delle stringhe}\label{strings2so}

\begin{lstlisting}[
frame=lines, 
caption={Stringe estratte dal file \texttt{2.so} (1)}, 
label={code:2so-1},
firstnumber=465
]
...
/opt/freeware/lib/gcc/powerpc-ibm-aix6.1.0.0/4.2.0/ppc64:/opt/freeware/lib/gcc/powerpc-ibm-aix6.1.0.0/4.2.0:/opt/freeware/lib/gcc/powerpc-ibm-aix6.1.0.0/4.2.0/../../..:/usr/lib:/lib
...
\end{lstlisting}

Seguendo lo stesso ragionamento descritto in \ref{subsection:InjectionAPIExecutableE}, comprendiamo dal listato \ref{code:2so-1} che gli attaccanti si siano serviti della versione 4.2.0 di GCC\footnote{Cfr. \texttt{http://www.gnu.org/software/gcc/gcc-4.2/}} compatibile con l'architettura PowerPC\texttrademark con sistema operativo AIX 6.1 (di quest'ultimo il supporto è terminato ufficialmente il 30 Aprile del 2017.\footnote{Cfr. \texttt{https://www-01.ibm.com/support/docview.wss?uid=swg21634678\#AIX}}).

La libreria esporta una grandissima quantità di funzioni molte delle quali riguardanti la manipolazione dei messaggi basati su protocollo ISO8583, alcune delle quali riportate nel listato \ref{code:2so-2}.

\begin{lstlisting}[
frame=lines, 
caption={Stringe estratte dal file \texttt{2.so} (2)}, 
label={code:2so-2},
firstnumber=545
]
...
DL_ISO8583_MSG_Init
DL_ISO8583_MSG_Free
DL_ISO8583_MSG_SetField_Str
DL_ISO8583_MSG_SetField_Bin
DL_ISO8583_MSG_RemoveField
DL_ISO8583_MSG_HaveField
DL_ISO8583_MSG_GetField_Str
DL_ISO8583_MSG_GetField_Bin
DL_ISO8583_MSG_Pack
DL_ISO8583_MSG_Unpack
DL_ISO8583_MSG_Dump
DL_ISO8583_MSG_AllocField
DL_ISO8583_COMMON_SetHandler
DL_ISO8583_DEFS_1987_GetHandler
DL_ISO8583_DEFS_1993_GetHandler
DL_ISO8583_FIELD_Pack
DL_ISO8583_FIELD_Unpack
...
\end{lstlisting}

\begin{lstlisting}[
frame=lines, 
caption={Stringhe estratte dal file \texttt{2.so} (3)}, 
label={code:2so-3},
firstnumber=545
]
Blocked Message(msg=%04x, term=%02x, pcode=%06x, pan=%s)
Passed Message(msg=%04x, term=%02x, pcode=%06x, pan=%s)
[recv] ret=%d
send ret = %d, err = %d
/tmp/.ICE-unix/context.dat
/tmp/.ICE-unix/tmp%d_%d.log
[%04d-%02d-%02d %02d:%02d:%02d][PID:%4u][TID:%4u] %s
/tmp/.ICE-unix/config_%d
/tmp/.ICE-unix/tmprd%d_%d.log
/tmp/.ICE-unix/tmpwt%d_%d.log
[DetourInitFunc] dlopen error(%s)
[DetourInitFunc] org_func(%p) %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X
[DetourInitFunc] new_func(%p) %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X
[DetourInitFunc] dlsym error(%s)
Success
Failed
DetourInitFunc(%s, %s) %s
[DetourInitFunc] org_func=%p new_func=%p
[DetourAttach] hook_func_addr=%p, new_func_addr=%p
[DetourAttach] after mmap=%p
[DetourAttach] copy_func(%x) %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X
[DetourAttach] hook_func_addr(%x) %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X
[DetourDetach] hook_func_addr(%x) %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X %02X
\end{lstlisting}

Come dimostrato dal frammento riportato in \ref{code:2so-3} e dall'analisi di alcuni frammenti chiave del codice assembly in \ref{subsubsection:outDumpLog}, la libreria svolge un'\textbf{intensa attività di logging} scrivendo direttamente in memoria di massa attraverso una procedura chiamata \texttt{out\_dump\_log}.
Dal listato \ref{code:2so-3} possiamo osservare un'interessante riferimento al percorso \texttt{/tmp/.ICE-unix/}: in accordo alla documentazione relativa alla versione R6.8.2 di X11\footnote{Cfr. \texttt{https://www.x.org/releases/X11R6.8.2/doc/RELNOTES5.html}} (la famosa implementazione del X Window System\footnote{Cfr. \texttt{https://www.x.org/wiki/}})
il suddetto percorso viene usato per ospitare una serie di \texttt{socket} sfruttate dal protocollo \textbf{Inter-Client Exchange} (\textbf{ICE}), utilizzato per la risoluzione di varie problematiche come quelle legate all'autenticazione o al \textit{byte order negotiation}\footnote{Cfr. \texttt{https://www.x.org/releases/X11R7.7/doc/libICE/ICElib.html\#Overview\_of\_ICE}}. Pertanto, sebbene ne ignoriamo le motivazioni, abbiamo motivo di ritenere che gli attaccanti abbiano interagito con la GUI session manager di X11 attraverso il protocollo ICE.

\begin{lstlisting}[
frame=lines, 
caption={Stringhe estratte dal file \texttt{2.so} (4)}, 
label={code:2so-4},
firstnumber=545
]
GenerateRandAmount
GenerateResponseTransaction1
GenerateResponseTransaction2
GenerateResponseInquiry1
Crypt
\end{lstlisting}

Osservando infine il frammento riportato in \ref{code:2so-4} possiamo comprendere l'esistenza di alcuni metodi utilizzati per rispondere alle transazioni finanziarie generate dai sistemi bancari sotto attacco.

\subsubsection{Analisi del codice assembly}

Benché naturalmente sprovvista di una procedura \texttt{main}, trattandosi di una shared library, il file \texttt{2.so} assume un ruolo centrale per il corretto svolgimento dell'attacco poiché esporta tutte le procedure necessarie per manipolare le transazioni elettroniche dei sistemi finanziari attaccati.
I metodi esportati dal file \texttt{so.2}, una parte dei quali sono mostrati nel listato \ref{code:2.so-3}, sono molto numerosi e riguardano principalmente l'ispezione e la manipolazione dei messaggi usati dal protocollo ISO8583 a cui si aggiungono altre procedure di supporto, tra cui quelle usate per implementare un meccanismo di logging (\texttt{out\_dump\_log}) e altre usate per gestire una tabella hash (\texttt{hashmap\_new}, \texttt{hashmap\_init}, \texttt{hashmap\_get} ecc.).
Di seguito riportiamo l'analisi di alcune delle procedure principali presenti nel file.

\subsubsection{La procedura \texttt{DL\_ISO8583\_MSG\_GetField\_Bin}} 

Analizzando le prime righe di codice della procedura, riportate in parte nel listato \ref{code:2.so-4}, troviamo molte istruzioni \texttt{std} e \texttt{mr} utilizzanti i registri \texttt{r0} e \texttt{r31} come sorgenti per popolare un altro insieme di registri; perciò si può supporre che i registri \texttt{r0} e \texttt{r31} siano stati usati per contenere i dati passati come argomento alla funzione, presumibilmente l'indirizzo dell'area di memoria del messaggio da ispezionare e un riferimento al campo da estrarre (probabilmente una stringa o un identificatore numerico).

\begin{lstlisting}[
frame=lines, 
caption={Codice assembly estratto dal file \texttt{2.so}}, 
label={code:2.so-4},
firstnumber=347]
std     r31,-8(r1)
stdu    r1,-80(r1)
mr      r31,r1
mr      r0,r3
std     r4,136(r31)
std     r5,144(r31)
std     r6,152(r31)
stw     r0,128(r31)
\end{lstlisting}

Un altro frammento della stessa procedura, riportato nel listato \ref{code:2.so-5}, mostra come l'ispezione del campo di interesse appartenente al messaggio ISO8583 avvenga per mezzo di un ciclo; notiamo infatti diverse istruzioni di \texttt{beq} (\textit{Branch On Equal}) aventi come argomento uno stesso indirizzo target e altrettante istruzioni \texttt{cmpdi} (\textit{Compare Doubleword Immediate}). 
E' probabile che tale ciclo sia stato usato per attraversare il flusso di byte che compone un certo messaggio fino al raggiungimento dell'indirizzo corrispondente al campo di intessere che pare venga restituito alla funzione chiamante per mezzo di un'apposita istruzione \texttt{mr} coinvolgendo il registro \texttt{r3} come output (riga 14010).

\begin{lstlisting}[
frame=lines, 
caption={Codice assembly estratto dal file \texttt{2.so}}, 
label={code:2.so-5},
firstnumber=347]
cmpdi   cr7,r0,0
beq     cr7,0x10002048
lwz     r0,128(r31)
cmplwi  cr7,r0,128
bgt     cr7,0x10002048
lwz     r0,128(r31)
clrldi  r9,r0,32
ld      r11,136(r31)
addi    r0,r9,1
rldicr  r0,r0,4,59
add     r9,r0,r11
addi    r9,r9,8
ld      r0,0(r9)
cmpdi   cr7,r0,0
beq     cr7,0x10002048
\end{lstlisting}

\subsubsection{La procedura \texttt{DL\_ISO8583\_MSG\_GetField\_Str}}

La funzione \texttt{DL\_ISO8583\_MSG\_GetField\_Str} è sostanzialmente identica a quella precedentemente descritta sebbene il nome suggerisca che tale funzione restituisca indubbiamente una stringa piuttosto che dati binari.

\subsubsection{La procedura \texttt{DL\_ISO8583\_MSG\_SetField\_Bin}}

L'esistenza di tale procedura dimostra che il malware non si limita solo all'ispezione dei messaggi ma che è in grado di manipolarne i contenuti. 
Come mostrato nel listato \ref{code:2.so-5}, in modo simile alle altre procedure, il messaggio viene dapprima ispezionato per mezzo di istruzioni di salto incondizionato (b) e condizionato (ble) insieme ad opportune istruzioni di comparazione (cmplwi) fino al raggiungimento dell'indirizzo corrispondente al campo da modificare.
Una successiva istruzione di salto alla procedura \texttt{DL\_ISO8583\_MSG\_AllocField}, attraverso la quale viene presumibilmente allocata un'opportuna area di memoria atta ad ospitare il campo con i nuovi valori, è seguita infine dall'invocazione della procedura \texttt{memmove} completando così l'operazione di modifica del messaggio.

\begin{lstlisting}[
frame=lines, 
caption={Codice assembly estratto dal file \texttt{2.so}}, 
label={code:2.so-6},
firstnumber=347]
cmplwi  cr7,r0,128
ble     cr7,0x10001b84
li      r0,1
std     r0,128(r31)
b       0x10001c08
lwz     r0,208(r31)
clrldi  r9,r0,32
lwz     r0,224(r31)
clrldi  r0,r0,32
addi    r11,r31,120
mr      r3,r9
mr      r4,r0
ld      r5,232(r31)
mr      r6,r11
bl      0x100026e0 <._DL_ISO8583_MSG_AllocField>
nop
mr      r0,r3
std     r0,112(r31)
ld      r0,112(r31)
cmpdi   cr7,r0,0
bne     cr7,0x10001c00
ld      r9,120(r31)
lwz     r0,224(r31)
clrldi  r0,r0,32
mr      r3,r9
ld      r4,216(r31)
mr      r5,r0
bl      0x1000034c <.memmove>
\end{lstlisting}

\subsubsection{La procedura \texttt{DL\_ISO8583\_MSG\_RemoveField}}

La procedura \texttt{DL\_ISO8583\_MSG\_RemoveField} presenta a una struttura sostanzialmente identica a quelle viste finora. L'unica differenza degna di nota, come mostrato nel listato \ref{code:2.so-7}, riguarda l'eliminazione del campo specificato che avviene attraverso una chiamata alla procedura \texttt{free}.

\begin{lstlisting}[
frame=lines, 
caption={Codice assembly estratto dal file \texttt{2.so}}, 
label={code:2.so-7},
firstnumber=347]
mr      r3,r0
bl      0x100002dc <.free>
ld      r2,40(r1)
\end{lstlisting}

\subsubsection{La procedura \texttt{out\_dump\_log}}\label{subsubsection:outDumpLog}

La procedura denominata \texttt{out\_dump\_log}, usata, come suggerisce il nome, per ovvie finalità legate al \textbf{debugging} dell'applicazione e al \textbf{logging} di tutte le informazioni di interesse raccolte durante l'attacco, rappresenta quella invocata il maggior numero di volte all'interno del codice della libreria: ben 32 volte. Una delle procedure esportate, chiamata \texttt{NewRead}, invoca la suddetta funzione ben 11 volte e, in generale, l'invocazione è preceduta quasi sempre da un'altra nei confronti della funzione \texttt{ReadRecv}; quest'ultima considerazione dimostra come quasi certamente gli attaccanti ispezionavano il contenuto dei messaggi ricevuti salvando tutti i dati in \textbf{memoria di massa}, affinché fosse accessibile di seguito per un qualche scopo.


 rappresenta quella invocata più frequentemente all'interno del codice; ben 32 volte il che dimostra la sua importanza dato il volume di dati registrato dagli attaccanti.

Tale procedura, richiamata molte volte nel codice, ha come scopo quello di scrivere messaggi di log opportunamente formattati in un file esterno, forse per motivi di debug o per tener traccia dello stato di avanzamento dell'attacco.
La prima porzione del codice assembly, mostrata nel listato \ref{code:2.so-8}, è dominata da una grande quantità di istruzioni \texttt{std} usate per popolare tutti i registri dalla numero 3 alla 10 e dalla numero 23 alla 31, che probabilmente conterranno i dati da stampare nel file di log.
Dal momento che la totalità di queste istruzioni usano i registri \texttt{r0} e \texttt{r31} come sorgenti quest'ultimi conterranno i dati passati come argomento alla funzione.

\begin{lstlisting}[
frame=lines, 
caption={Codice assembly estratto dal file \texttt{2.so}}, 
label={code:2.so-8},
firstnumber=347]
mflr    r0
std     r23,-72(r1)
std     r24,-64(r1)
std     r25,-56(r1)
std     r26,-48(r1)
std     r27,-40(r1)
std     r28,-32(r1)
std     r29,-24(r1)
std     r31,-8(r1)
std     r0,16(r1)
stdu    r1,-4624(r1)
mr      r31,r1
std     r4,4680(r31)
std     r5,4688(r31)
std     r6,4696(r31)
std     r7,4704(r31)
std     r8,4712(r31)
std     r9,4720(r31)
std     r10,4728(r31)
std     r3,4672(r31)
\end{lstlisting}

La parte centrale della procedura, mostrata invece nel listato \ref{code:2.so-9}, contiene un insieme di istruzione il cui scopo evidentemente è quello di scrivere tutti i dati precedentemente raccolti su un file.
Come si può facilmente notare dal listato  \ref{code:2.so-9}, è facile intuire che ogni stringhe venga dapprima realizzata facendo ricorso alla funzione standard \texttt{snprintf} e poi, dopo l'apertura del file di log attraverso la chiamata di sistema \texttt{fopen}, vengano scritti aggiungendo ulteriori informazioni come data e ora locale, come dimostrano le istruzioni di salto verso le procedure \texttt{gettimeofday} e \texttt{localtime}. 
La procedura si conclude con una chiamata alla procedura \texttt{close} per poi chiudersi definitivamente con l'istruzione \texttt{blr} che permette la ritornare alla procedura chiamante.

\begin{lstlisting}[
frame=lines, 
caption={Codice assembly estratto dal file \texttt{2.so}}, 
label={code:2.so-9},
firstnumber=347]
bl      0x10000748 <.snprintf>
ld      r2,40(r1)
addi    r0,r31,4280
mr      r3,r0
ld      r4,856(r2)
bl      0x10000770 <.fopen>
ld      r2,40(r1)
mr      r0,r3
std     r0,152(r31)
ld      r0,152(r31)
cmpdi   cr7,r0,0
beq     cr7,0x1000a0ec
addi    r0,r31,4264
mr      r3,r0
li      r4,0
bl      0x10000798 <.gettimeofday>
ld      r2,40(r1)
addi    r0,r31,4264
mr      r3,r0
bl      0x100007c0 <.localtime>
\end{lstlisting}

\newpage





\newpage
\subsection{Il file \texttt{5cfa1c2cb430bec721063e3e2d144feb}}
 
fdsfdsfdsfsdfsdf 
 
\begin{table}[h!]
  
    \caption{Dettagli del file \texttt{5cfa1c2cb430bec721063e3e2d144feb}}
    \centering
    \label{tab:table3}
    
    \begin{adjustbox}{center=\textwidth}
 
    \begin{tabular}{l|r}
      \toprule
      \textbf{Descrizione} & \textbf{Valore} \\
      \midrule
      
      Nome & \texttt{5cfa1c2cb430bec721063e3e2d144feb} \\
      \hline
      Dimensione (\textit{byte}) & \texttt{1643616} \\
   \hline
      Tipo di file & \texttt{PE32 executable (GUI) Intel 80386, for MS Windows} \\
    \hline
      MD5 digest & \texttt{5cfa1c2cb430bec721063e3e2d144feb}\\ 
 \hline
      SHA1 digest & \texttt{c1a9044f180dc7d0c87e256c4b9356463f2cb7c6} \\ 
     \hline
      SHA256 digest & \texttt{820ca1903a30516263d630c7c08f2b95f7b65dffceb21129c51c9e21cf9551c6} \\ 
\hline
      \multirow{2} {*}{SHA512 digest} & \texttt{a65e615203269b657e55fe842eca0542a4cd3bac80d3039d85dfb5fbbfdb5768}\\
      & \texttt{bbabe2fc86f213fb1a759124a82780a1cfbb9fd8457f4923cefad73e9db6f6a4}  \\
      
      \bottomrule
    \end{tabular}
    \end{adjustbox}
  
\end{table}






\newpage
\chapter{Analisi degli impatti subiti}

L'attacco perpetrato dal gruppo Lazarus ha incontestabilmente causato una serie di danni diretti ed indiretti nei confronti dell'istituto bancario, comportando impatti considerevoli a livello economico-finanziario, politico-sociale e di reputazione, aggravati non appena la notizia dell'avvenuto attacco è divenuta di dominio pubblico.

\section{Impatti socio-economici}

Essendo stati compromessi i processi governanti funzionalità critiche del sistema, l'attacco ha determinato innanzitutto un'interruzione dei un servizi legittimi offerti dall'istituto bancario, come quelli aventi funzione di credito sulle quali si basano le transazioni finanziare, comportando conseguenze economico-sociali molto gravi tra cui:
\begin{itemize}
\item Danni economici diretti a danno dell'istituto per mancati introiti.
\item Danni economici indiretti, difficilmente quantificabili, a danno del tessuto economico sociale ed, in particolare, alle varie attività economiche che usufruiscono quotidianamente dei servizi offerti dall'istituto; si pensi, ad esempio, alle transizioni finanziare indispensabili  alle aziende per eseguire attività basilari come il pagamento delle forniture, degli stipendi dei dipendenti, le richieste di credito ecc. 
\end{itemize}

L'introduzione di codice maligno all'interno dei sistema ha avuto molteplici conseguenze di notevole impatto economico quali:
\begin{itemize}
\item Furto di denaro a danno dei clienti dell'istituto verso i quali quest'ultima ha dovuto rispondere con operazioni di risarcimento. 
\item Danni economico-finanziari dovuti alle operazioni di ripristino del sistema, aggiornamento dei software e di tutti i meccanismi di sicurezza.
\end{itemize}

\section{Impatti sulla reputazione}

La diffusione della notizia riguardante l'avvenuto attacco attraverso vari canali di informazione ha indubbiamente causato un danno alla reputazione dell'istituzione bancaria per via degli scarsi sforzi rivolti alla sicurezza informatica, esponendo a gravi rischi i propri clienti sia dal punto di vista economico che di privacy, benché, dalle analisi, non risulta che il malware FASTCash sia stato concepito come spyware.

I danni all'immagine dell'istituto avranno inevitabilmente effetti di lungo termine a causa dalla perdita degli attuali e dei futuri clienti.

\newpage
\chapter{Contromisure}

In questo capitolo forniremo una analisi dettaglia delle possibili contromisure capaci di contrastare le attività del malware FASTCash sia modo pro-attivo che reattivo.

\subsection{Aggiornamenti software}

Come suggerito dalla totalità delle aziende di sicurezza informatica, al fine di contrastare in generale gli attacchi informatici, è indispensabile una \textbf{regolare attività di aggiornamento} di tutto il parco software.

I ricercatori della Symantec hanno stabilito\footnote{\texttt{https://www.symantec.com/blogs/threat-intelligence/fastcash-lazarus-atm-malware}} che il mancato aggiornamento del sistema operativo AIX utilizzato dai payment switch server abbia compromesso la sicurezza del sistema poiché privata del supporto IBM relativamente alle patch di sicurezza le quali avrebbero potuto contrastare o, nel migliore delle ipotesi, impedire l'attacco informatico. 

\subsubsection{Analisi dell'efficacia degli aggiornamenti software}

Sebbene una regolare attività di aggiornamento rappresenti un requisito imprescindibile per garantire standard di sicurezza elevati, riteniamo, in virtù delle caratteristiche tecniche del malware e della forma di attacco perpetrata dai cyber-criminali, tale attività poco efficace contro FASTCash.
 
Come abbiamo avuto modo di notare durante l'analisi, l'attacco effettuato dal malware FASTCash è per sua natura  molto difficile da contrastare attraverso gli aggiornamenti di sicurezza perché basa il proprio funzionamento sull'uso (sarebbe meglio dire \textit{abuso}) dei servizi essenziali offerti dal kernel del sistema operativo, in particolare la gestione dei processi/thread e i meccanismi di lettura e scrittura. 

Non avendo sfruttato una vera e propria vulnerabilità del sistema operativo, come stabilito dai report della Symantec e della NCCIC, è giustificabile ritenere che l'aggiornamento dei software non avrebbe contrastato efficacemente il malware FASTCash. 

Supponendo anche rilascio di aggiornamenti di sicurezza che impongano restrizioni sull'uso delle \textit{syscall} per l'accesso ai servizi del SO, il malware FASTCash continuerebbe ad agire incontrastato essendo nascosto all'interno di un processo legittimo; oltre ad essere poco efficace, restrizioni sull'uso delle syscall potrebbero comportare il verificarsi di effetti collaterali legati al tentativo da parte di processi legittimi di accedere ai servizi del SO, comportando costi aggiuntivi per lo sviluppo di un software compatibile con le nuove impostazioni. 

\subsection{Principio del privilegio minimo e gli ACL}

In base a quanto detto finora, riteniamo che gli sforzi finalizzati a reagire a questa forma di attacchi dovrebbero essere rivolti nell'impedire ai cyber-criminali di poter intraprendere l'attacco fin dal principio. 

Le contromisure da adottare devono innanzitutto basarsi sul cosiddetto \textbf{principle of least privilege} (\textbf{PoLP}), in italiano \textbf{principio del privilegio minimo}, in cui si stabilisce che \textit{un opportuno sistema di sicurezza deve fornire un meccanismo che assicuri che ogni processo in esecuzione sul sistema sia in grado di accedere solo ed esclusivamente alle informazioni di cui necessità per garantire il suo corretto e legittimo funzionamento.}

Come noto, una possibile implementazione si basa sull'uso delle \textbf{access control list} (\textbf{ACL}), in italiano \textbf{lista di controllo degli accessi}, ovvero opportune strutture dati, generalmente tabelle, contenenti informazioni che specifichino quali utenti o gruppi hanno l'autorizzazione ad accedere alle risorse del sistema come processi, file o risorse di rete.

L'adozione di apposite restrizioni di accesso al pseudo-filesystem \texttt{/proc}, accedendo alla quale i criminali hanno potuto compiere l'attacco di process injection, avrebbe potuto ostacolare o impedire l'attacco benché tale forma di sicurezza si riveli priva di utilità qualora gli attaccanti, attraverso tecniche di \textit{privilege escalation}, fossero riusciti ad ottenere le autorizzazioni necessarie per accedere alle risorse.

\subsection{Meccanismi di Whitelisting}

Un'altra efficace contromisura consiste nell'adottare meccanismi di \textit{whitelisting} che consentano l'accesso alle risorse del sistema \textit{solo ed esclusivamente} ai processi attendibili. 

I software di whitelisting basano il proprio funzionamento sulla creazione preliminare di una lista, denominata \textit{whitelist}, contenente gli identificati, solitamente stringhe hash, di tutti i file eseguibili autorizzati ad accedere a determinate risorse del sistema. Utilizzando un approccio denominato \textit{default deny}, che si contrappone all'approccio \textit{default allow} adottato dalla maggioranza degli antivirus, questi software impediscono l'esecuzione di ogni file eseguibile sconosciuto, ovvero non presente nella whitelist, a prescindere dal livello di privilegio dell'utente.

Nei sistemi basati su Unix, di cui fa parte anche il sistema operativo AIX, esistono moltissimi tool di whitelisting come \textit{AppAmour}, integrato nella maggior parte delle distribuzioni Linux; altri esempi noti sono \textit{SELinux} e \textit{grsecurity}.

Riteniamo che l'uso di un qualsiasi strumento di whitelisting, opportunamente configurato e testato, avrebbe potuto con buone probabilità contrastare le attività del malware FASTCash impedendo al processo maligno responsabile della code injection di avviarsi. 

Bisogna ammettere, tuttavia, che tale contromisura è lungi dall'essere una panacea; gli attaccanti avrebbero potuto, per mezzo di tecniche di \textit{priviledge escalation}, riuscire a ottenere le autorizzazioni necessarie per alterare il contenuto della whitelist stessa allo scopo di consentire la successiva esecuzione del malware. Per tale motivo è indispensabile, allo scopo di non compromettere l'efficacia di questi strumenti, provvedere ad una opportuna protezione degli account responsabili della gestione della whitelist mediante forme di autenticazione più sofisticate e sicure.\footnote{\textit{Cfr.} \texttt{https://www.sans.org/reading-room/whitepapers/application/application-whitelisting-panacea-propaganda-33599}}

\subsection{Monitoring}

L'attività che più di tutte avrebbe contribuito a contrastare le azioni intraprese dal malware FASTCash è rappresentato dal \textit{monitoring}, ovvero la possibilità, offerta da una variegata suite di applicazioni, di poter eseguire il \textit{log di tutti gli eventi di interesse in un sistema} come, nel nostro caso specifico, l'esecuzione di transazioni finanziarie, con lo scopo di riuscire a rilevare le attività del malware e poter quindi reagire tempestivamente per limitare i danni.

Questi sofisticati software non si limitano semplicemente alla raccolta di dati ma sono in grado, previa un'opportuna configurazione, di poter reagire qualora rilevassero attività sospette attraverso l'esecuzione regolare di attività di audit sui log raccolti. 

Qualora rilevassero attività insolite, questi software reagiscono emettendo i cosiddetti \textit{alert}, avvisi finalizzati ad informare il personale incaricato della sicurezza del sistema della presenza di attività insolite nel sistema, la quale potrà infine prende provvedimenti per contrastate le attività del malware.  

\subsection{GUI session manager}

Durante l'analisi del file \texttt{2.so}, abbiamo notato come gli attaccanti, per ragioni che purtroppo ignoriamo, hanno potuto interagire con la GUI session manager di X11 attraverso il protocollo ICE per completare l'attacco.

Da quanto dichiarato anche dal report NCCIC, è indubbio il fatto che gli attaccanti abbiano sfruttato la presenza di X11 accedendo alla directory /tmp all'intenro della quale sono contentute le informazione relative alla sessione della GUI Manager di X11.

Riteniamo che l'utilizzo di X11 all'itnro di un sistema cosiì crucila come quelli adibiti alla gestione dei servizi bancari sia una grave falla di siscurezza poiché tale scelta, oltrea sesporre le vulnerabilità del sistema dd


















Maintain up-to-date antivirus signatures and engines.
Keep operating system patches up-to-date.
Disable file and printer sharing services. If these services are required, use strong passwords or Active Directory authentication.
Restrict users’ ability (i.e., permissions) to install and run unwanted software applications. Do not add users to the local administrators group unless required.
Enforce a strong password policy and require regular password changes.
Exercise caution when opening email attachments, even if the attachment is expected and the sender appears to be known.
Enable a personal firewall on organization workstations, and configure it to deny unsolicited connection requests.
Disable unnecessary services on organization workstations and servers.
Scan for and remove suspicious email attachments; ensure the scanned attachment is its “true file type” (i.e., the extension matches the file header).
Monitor users’ web browsing habits; restrict access to sites with content that could pose cybersecurity risks.
Exercise caution when using removable media (e.g., USB thumb drives, external drives, CDs).
Scan all software downloaded from the internet before executing.
Maintain situational awareness of the latest cybersecurity threats.
Implement appropriate ACLs.



\listoffigures
\listoftables
\lstlistoflistings

\end{document}




